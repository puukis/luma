// ========================================
// ğŸ® LUMA DUNGEON CRAWLER - Text Adventure
// ========================================
// Demonstrates: classes, modules, echo, swap, maybe/otherwise, until

module @app.adventure

use @std.io as io

// ========== Game Classes ==========

class Hero {
  def init(name, hp, attack) {
    this.name = name
    this.hp = hp
    this.maxHp = hp
    this.attack = attack
    this.gold = 0
    this.potions = 2
  }
  
  def isAlive() {
    return this.hp > 0
  }
  
  def heal() {
    if (this.potions > 0) {
      this.potions = this.potions - 1
      this.hp = this.hp + 30
      if (this.hp > this.maxHp) {
        this.hp = this.maxHp
      }
      io.println("ğŸ§ª Used potion! HP restored to " + this.hp)
    } else {
      io.println("âŒ No potions left!")
    }
  }
  
  def stats() {
    io.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
    io.println("ğŸ¦¸ " + this.name)
    io.println("  â¤ï¸  HP: " + this.hp + "/" + this.maxHp)
    io.println("  âš”ï¸  ATK: " + this.attack)
    io.println("  ğŸ’° Gold: " + this.gold)
    io.println("  ğŸ§ª Potions: " + this.potions)
    io.println("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
  }
}

class Monster {
  def init(name, hp, attack, gold) {
    this.name = name
    this.hp = hp
    this.attack = attack
    this.gold = gold
  }
  
  def isAlive() {
    return this.hp > 0
  }
}

// ========== Battle System ==========

def battle(hero, monster) {
  io.println("")
  io.println("âš”ï¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• âš”ï¸")
  io.println("  A wild " + monster.name + " appears!")
  io.println("  Monster HP: " + monster.hp + " | ATK: " + monster.attack)
  io.println("âš”ï¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• âš”ï¸")
  
  round = 1
  
  // Battle until someone dies
  until (hero.hp <= 0) {
    if (monster.hp <= 0) {
      return true  // Hero wins
    }
    
    io.println("")
    io.println("â”€â”€ Round " + round + " â”€â”€")
    
    // Hero attacks
    damage = hero.attack + (round * 2)  // Combo bonus!
    monster.hp = monster.hp - damage
    io.println("ğŸ’¥ " + hero.name + " deals " + damage + " damage!")
    
    if (monster.hp <= 0) {
      io.println("ğŸ‰ " + monster.name + " defeated!")
      hero.gold = hero.gold + monster.gold
      io.println("ğŸ’° Gained " + monster.gold + " gold!")
      return true
    }
    
    // Monster attacks
    monsterDamage = monster.attack
    hero.hp = hero.hp - monsterDamage
    io.println("ğŸ”¥ " + monster.name + " strikes back for " + monsterDamage + "!")
    io.println("   " + hero.name + " HP: " + hero.hp)
    
    round = round + 1
  }
  
  return false  // Hero lost
}

// ========== Dungeon Encounters ==========

def spawnMonster(level) {
  // Different monsters based on dungeon level
  if (level == 1) {
    return Monster("ğŸ‘» Ghost", 30, 8, 10)
  }
  if (level == 2) {
    return Monster("ğŸº Wolf", 45, 12, 20)
  }
  if (level == 3) {
    return Monster("ğŸ§Ÿ Zombie", 60, 15, 35)
  }
  if (level == 4) {
    return Monster("ğŸ‰ Dragon", 100, 25, 100)
  }
  return Monster("ğŸ’€ Skeleton", 40, 10, 15)
}

def treasureRoom(hero) {
  io.println("")
  io.println("âœ¨ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• âœ¨")
  io.println("  You found a TREASURE ROOM!")
  io.println("âœ¨ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• âœ¨")
  
  // Use maybe to simulate risky treasure
  maybe {
    goldFound = 50
    hero.gold = hero.gold + goldFound
    io.println("ğŸ’ Found " + goldFound + " gold!")
    hero.potions = hero.potions + 1
    io.println("ğŸ§ª Found a health potion!")
  } otherwise {
    io.println("ğŸ’¨ It was a trap! Nothing here...")
  }
}

// ========== Main Game Loop ==========

io.println("")
io.println("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
io.println("â•‘   ğŸ° WELCOME TO LUMA DUNGEON ğŸ°       â•‘")
io.println("â•‘        A Text Adventure Game          â•‘")
io.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
io.println("")

// Create our hero
player = Hero("Luma Knight", 100, 15)
player.stats()

// Dungeon crawl - 4 levels!
level = 1
maxLevel = 4

echo maxLevel {
  io.println("")
  io.println("ğŸšª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
  io.println("   DUNGEON LEVEL " + level)
  io.println("ğŸšª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
  
  // Spawn and fight monster
  monster = spawnMonster(level)
  won = battle(player, monster)
  
  if (won == false) {
    io.println("")
    io.println("ğŸ’€ GAME OVER ğŸ’€")
    io.println("You were defeated on level " + level)
    return nil
  }
  
  // Heal if low HP
  if (player.hp < 40) {
    io.println("")
    io.println("âš ï¸  HP Critical! Auto-using potion...")
    player.heal()
  }
  
  // Treasure room on even levels
  if (level == 2) {
    treasureRoom(player)
  }
  if (level == 4) {
    treasureRoom(player)
  }
  
  level = level + 1
}

// Victory!
io.println("")
io.println("ğŸ† â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ†")
io.println("    CONGRATULATIONS! YOU CONQUERED THE")
io.println("          LUMA DUNGEON!")
io.println("ğŸ† â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ†")
io.println("")
player.stats()

// Bonus: Demonstrate swap operator
io.println("")
io.println("ğŸ”„ Bonus Demo: The SWAP operator!")
a = "First"
b = "Second"
io.println("Before swap: a=" + a + ", b=" + b)
a <-> b
io.println("After swap:  a=" + a + ", b=" + b)
